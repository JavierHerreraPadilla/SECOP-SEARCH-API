<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <title>secop api</title>
</head>
<body>
<nav class="navbar info text-white">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
          <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
        </a>

        <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
          <li><a href="{{ url_for('home') }}" class="nav-link px-5 text-light"><b>SECOP II API</b></a></li>
          <li><a href="https://www.linkedin.com/in/javier-ignacio-herrera-padilla-516690a4/" target="_blank" class="nav-link px-2 text-white">por Javier Herrera</a></li>
        </ul>
      </div>
    </div>
  </nav>

<div class="row">
    <div class="col-3 pt-5 mt-5">
        <div class="accordion accordion accordion-flush" id="accordionExample" style="background-color:transparent;">
          <div style="background-color:transparent;">
              <button style="background-color:transparent;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <h3 style="background-color:transparent; color:#F2E3DB; font-weight:200;">Columnas <i class="bi bi-caret-down"></i></h3>
              </button>
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
              <div class="accordion-body ps-0 pe-0 pt-0" style="background-color:transparent;">

            <ol class="list-group list-group-numbered">
                  <div class="accordion-item">
                  </div>
                {% for col in columns %}
              <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-start pt-3"  style="background-color:transparent; color:#F2E3DB;border:none;">
                <div class="ms-2 me-auto">
                  <div class="fw-bold" style="word-wrap: break-word;">{{ col.name }}</div>
                  <span class="badge bg-primary rounded-pill">{{ col.type}}</span>
                </div>
              </li>
                {% endfor %}
            </ol>

              </div>
            </div>
          </div>

    </div>
    </div>

    <div class="col-9">
            <div class="p-3">
                <h1 class="p-4" style="font-weight:200; font-size:50px;">Todos los contratos</h1>
                <p class="ps-4 mb-5" style="font-weight:200; font-size:20px;">Los contratos se recuperan en el orden de indexación en la base de datos.<br>Se retornan todas las {{ columns | length }} columnnas.<br>
                    Los parámetros <code>limit</code> y <code>offset</code> se pasan como parámetros <b>query</b>.
                </p>
                <div class="container bg-code ps-3">
                    <pre>
                        <code>
                        <h6 class="code-title">CURL</h6>
    curl -X 'GET' \
    'http://127.0.0.1:8000/all_contracts/?offset=0&limit=100&order_by_col=id' \
    -H 'accept: application/json'
                        <hr>
                        <h6 class="code-title">REQUEST USANDO PYTHON</h6>
    response = requests.get("http://127.0.0.1:8000/all_contracts/", params={"offset"=0, "limit":100,<br>
                                                                er_by_col":"id"}).json()
                        <hr>
                        <h6 class="code-title">EJEMPLO DE RESPUESTA</h6>
    [
        {
           "id": 0,
           "nit_entidad": 0,
           "nombre_entidad": "string",
            "departamento": "string",
            "ciudad": "string",
            "orden": "string",
            "sector": "string",
            "rama": "string",
            "entidad_centralizada": "string",
            "estado_contrato": "string",
            "descripcion_del_proceso": "string",
            "tipo_de_contrato": "string",
            "modalidad_de_contratacion": "string",
            "justificacion_modalidad_de": "string",
            "fecha_de_firma": "2023-05-28T21:15:16.990Z",
            "fecha_de_inicio_del_contrato": "2023-05-28T21:15:16.990Z",
            "fecha_de_fin_del_contrato": "2023-05-28T21:15:16.990Z",
            "condiciones_de_entrega": "string",
            "proveedor_adjudicado": "string",
            "es_pyme": "string",
            "obligaci_n_ambiental": "string",
            "valor_del_contrato": 0,
            "valor_pendiente_de_pago": 0,
            "valor_pagado": 0,
            "valor_pendiente_de_ejecucion": 0,
            "espostconflicto": "string",
            "urlproceso": "string",
            "destino_gasto": "string",nombre_representante_legal": "string",
            "identificaci_n_representante_legal": "string",
            "g_nero_representante_legal": "string",
            "ultima_actualizacion": "2023-05-28T21:15:16.990Z",
            "objeto_del_contrato": "string",
            "fecha_de_inicio_de_ejecucion": "2023-05-28T21:15:16.990Z",
            "fecha_de_fin_de_ejecucion": "2023-05-28T21:15:16.990Z",
            "fecha_inicio_liquidacion": "2023-05-28T21:15:16.990Z",
            "fecha_fin_liquidacion": "2023-05-28T21:15:16.990Z"
          }
       ]
                        </code>
                    </pre>
                </div>
            </div>

            <div class="p-3">   <h1 class="p-4" style="font-weight:200; font-size:50px;">Descripción</h1>
                <p class="ps-4 mb-5" style="font-weight:200; font-size:20px;">Similar a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html" style="text-decoration:none;" target="_blank"><code><span style="color:green;">.describe()</span></code></a> en Pandas, retorna el valor de contrato máximo, mínimo y promedio, así como el conteo de contratos por grupo.
                    <br>El parámetro sobre el cuál realizar la agrupación se pasa en el <code>PATH</code>.<br>
                Columnas:<br>
                </p>
                  <div class="container">
                    <table class="mb-5 ms-4">
                     <tr>                      <td class="justify-text-center">
                            <code>
                            departamento <br>
                            ciudad <br>
                            orden <br>
                            sector <br>
                            rama <br>
                            estado_contrato <br>
                            </code>
                       </td>
                       <td class="ps-5">
                            <code>
                            tipo_de_contrato <br>
                            modalidad_de_contratacion <br>
                            proveedor_adjudicado <br>
                            nombre_entidad <br>
                            month <br>
                            year <br>
                            </code>
                       </td>
                     </tr>
                    </table>
                  </div>

                <div class="container bg-code ps-3">
                 <pre>
                 <code>
                  <h6 class="code-title">CURL</h6>
                   curl -X 'GET' \
                   'http://127.0.0.1:8000/describe_full/es_pyme' \
                   -H 'accept: application/json'
                   <hr>
                   <h6 class="code-title">REQUEST USANDO PYTHON</h6>
                   response = requests.get("http://127.0.0.1:8000/describe_full/es_pyme").json()
                   <hr>
                   <h6 class="code-title">EJEMPLO DE RESPUESTA</h6>
    [
        {
            "group": "No",
            "max_valor": 6448090000000000,
            "min_valor": 0,
            "avg_valor": 61442249171.625175,
            "cantidad_contratos": 854827
        },    {
            "group": "Si",
            "max_valor": 6158661742599964,
            "min_valor": 0,
            "avg_valor": 61008735840.06525,
            "cantidad_contratos": 155173
        }
    ]
                        </code>
                    </pre>

                </div>


            <div class="p-3">
                <h1 class="p-4" style="font-weight:200; font-size:50px;">Filtrar contratos</h1>
                <p class="ps-4 mb-5" style="font-weight:200; font-size:20px;">Similar a un SoQL query del tipo <code><span>SELECT * FROM table WHERE col1 LIKE ("%var%"), col2 LIKE ("%var%"),..., colN LIKE ("%var%") </span></code>, retorna todos los contratos encontrados que cumplan las condiciones.
                    <br> En el body del request, se pueden pasar parámetros <code>limit</code> y <code>offset</code>.
                </p>

                <div class="container bg-code ps-3">
                 <pre>
                 <code>
                  <h6 class="code-title">ESQUEMA DEL REQUEST BODY (TODOS LOS PARÁMETROS SON OPCIONALES)</h6>
    {
        "search": {
          "nombre_entidad": "string",
          "departamento": "string",
          "ciudad": "string",
          "orden": "string",
          "sector": "string",
          "rama": "string",
          "estado_contrato": "string",
          "descripcion_del_proceso": "string",
          "modalidad_de_contratacion": "string",
          "es_pyme": "string",
          "valor_del_contrato": {  <span style="color:red;">   <-- Este parámetro permite filtrar por valor del contrato. "$gt" y "$lt" son ambos opcionales.</span>
            "$gt": 1_000_000,      <span style="color:red;">   <-- "$gt" (greater than) límite inferior</span>
            "$lt": 500_000_000     <span style="color:red;">   <-- "$lt" (less than) límite superior</span>
          },
          "order_by_column": "id"  <span style="color:red;">   <-- columna (valores, fechas, nit, etc) para ordenar los resultados de forma descendiente. "id" por defecto</span>
        },
        "limit": 100,              <span style="color:red;">   <-- 100 resultados por defecto</span>
        "offset": 0                <span style="color:red;">   <-- 0 offset por defecto</span>
     }
    <hr>
    <h6 class="code-title">CURL</h6>
    curl -X 'POST' \
      'http://127.0.0.1:8000/filter/' \
      -H 'accept: application/json' \
      -H 'Content-Type: application/json' \
      -d '{
      "search": {
        "nombre_entidad": "string",
        "departamento": "string",
        "ciudad": "string",
                      "orden": "string",
                      "sector": "string",
                      "rama": "string",
                      "estado_contrato": "string",
                      "descripcion_del_proceso": "string",
                      "modalidad_de_contratacion": "string",
                      "es_pyme": "string",
                        "valor_del_contrato": {
                          "$gt": 1000000,
                          "$lt": 500000000
                        },
                        "order_by_column": "id"
                      },
                      "limit": 100,
                      "offset": 0
                    }'
                   <hr>
                   <h6 class="code-title">EJEMPLO DE RESPUESTA</h6>
    [
      {
        "id": 0,
        "nit_entidad": 0,
        "nombre_entidad": "string",
        "departamento": "string",
        "ciudad": "string",
        "orden": "string",
        "sector": "string",
        "rama": "string",
        "entidad_centralizada": "string",
        "estado_contrato": "string",
        "descripcion_del_proceso": "string",
        "tipo_de_contrato": "string",
        "modalidad_de_contratacion": "string",
        "justificacion_modalidad_de": "string",
        "fecha_de_firma": "2023-05-28T21:30:08.646Z",
        "fecha_de_inicio_del_contrato": "2023-05-28T21:30:08.646Z",
        "fecha_de_fin_del_contrato": "2023-05-28T21:30:08.646Z",
        "condiciones_de_entrega": "string",
        "proveedor_adjudicado": "string",
        "es_pyme": "string",
        "obligaci_n_ambiental": "string",
        "valor_del_contrato": 0,
        "valor_pendiente_de_pago": 0,
        "valor_pagado": 0,
        "valor_pendiente_de_ejecucion": 0,
        "espostconflicto": "string",
        "urlproceso": "string",
        "destino_gasto": "string",
        "nombre_representante_legal": "string",
        "identificaci_n_representante_legal": "string",
        "g_nero_representante_legal": "string",
        "ultima_actualizacion": "2023-05-28T21:30:08.646Z",
        "objeto_del_contrato": "string",
        "fecha_de_inicio_de_ejecucion": "2023-05-28T21:30:08.646Z",
        "fecha_de_fin_de_ejecucion": "2023-05-28T21:30:08.646Z",
        "fecha_inicio_liquidacion": "2023-05-28T21:30:08.646Z",
        "fecha_fin_liquidacion": "2023-05-28T21:30:08.646Z"
      }
    ]
                        </code>
                    </pre>
                </div>



            </div>
 </div>
    </div>
</div>
</body>

<style>

body {
    background-color: #212A3E;
    color:#F2E3DB;
}

table {
    font-size:1.1rem;
}
nav {
background-color:  #116D6E;
}

.bg-code {
    background-color:black;
    width:80%;
}
.highlight{
    background-color: #E57C23;
}

bg-transparent-title {
    background-color: red;
}

.bg-transparent {
    background-color: #E57C23 !important;
}
.code-title {
color:#E57C23;
font-size:18px;
font-weight:bold;
letter-spacing:1.5px;"
}

</style>
</html>